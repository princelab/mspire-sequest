require File.expand_path( File.dirname(__FILE__) + '/../../../tap_spec_helper' )

require 'ms/sequest/srf'
require 'ms/sequest/srf/search'


# 'converting a large srf to mgf'
class SRF_TO_MGF < MiniTest::Spec
  def del(file)
    if File.exist?(file)
      File.unlink(file)
    end
  end

  def initialize(*args)
    super(*args)
    @file = Ms::TESTDATA + '/sequest/opd1_static_diff_mods/000.srf'
    @output = Ms::TESTDATA + '/sequest/opd1_static_diff_mods/000.mgf.tmp'
    @srf = Ms::Sequest::Srf.new(@file)
  end

  it 'converts to mgf' do
    @srf.to_mgf(@output)
    assert File.exist?(@output)
    output = IO.read(@output)
    # tests are just frozen right now, not checked for accuracy
    assert output.include?(SRF_TO_MGF_HELPER::FIRST_MSMS)
    assert output[1000..-1].include?(SRF_TO_MGF_HELPER::LAST_MSMS)
    del(@output)
  end
end

class SRF_TO_MGF_HELPER
  FIRST_MSMS = <<FINISH
BEGIN IONS
TITLE=000.2.2.1.dta
CHARGE=1+
PEPMASS=391.04541015625
111.976043701172 41418.0
112.733383178711 88292.0
113.536590576172 26129.0
149.049530029297 2852380.0
149.960266113281 110104.0
150.578399658203 4607.0
155.026885986328 16524.0
160.48388671875 17154.0
161.9013671875 6562.0
164.386596679688 76498.0
166.8427734375 1663866.0
167.719482421875 72010.0
168.693237304688 57081.0
197.131774902344 7933.0
217.975738525391 20193.0
218.799468994141 15350.0
222.215576171875 21254.0
223.027404785156 27495.0
224.90771484375 16117.0
225.895538330078 25061.0
253.583435058594 7431.0
255.372528076172 25846.0
257.151245117188 5435.0
258.856323242188 26408.0
260.166259765625 261245.0
260.812072753906 639646.0
261.715698242188 82724.0
262.366638183594 4.0
272.052124023438 43365.0
277.773315429688 159994.0
278.856872558594 2140713.0
279.935546875 397598.0
280.699951171875 4.0
289.641723632812 32978.0
290.385864257812 31836.0
291.786682128906 15850.0
296.626831054688 54212.0
298.6279296875 22051.0
300.035766601562 156183.0
301.489501953125 10696.0
307.485473632812 37712.0
326.803100585938 18038.0
351.965393066406 6909.0
359.648010253906 10347.0
361.146850585938 21067.0
364.831176757812 22587.0
370.079040527344 9646.0
371.641967773438 57566.0
372.577087402344 40545.0
373.967895507812 76673.0
374.671997070312 70584.0
388.660583496094 22746.0
405.444030761719 23893.0
406.481384277344 27502.0
407.412780761719 18959.0
781.085327148438 10104.0
END IONS

FINISH

LAST_MSMS = <<FINISH
BEGIN IONS
TITLE=000.3748.3748.3.dta
CHARGE=3+
PEPMASS=433.56494098625
143.466918945312 2110.0
151.173095703125 4134.0
158.817443847656 2565.0
178.629333496094 6114.0
180.065307617188 879.0
185.164703369141 2364.0
206.865417480469 7925.0
210.208190917969 1242.0
212.763122558594 893.0
217.749298095703 2202.0
227.912048339844 4343.0
235.973571777344 2485.0
236.941436767578 679.0
251.645324707031 4690.0
252.677307128906 7145.0
271.46435546875 1504.0
275.466674804688 5912.0
276.738586425781 1819.0
278.331237792969 775.0
282.728149414062 963.0
287.679931640625 1749.0
288.412719726562 2603.0
291.451843261719 3082.0
292.405212402344 8303.0
299.569091796875 5620.0
302.3056640625 2007.0
306.021362304688 1564.0
308.79541015625 3738.0
312.496154785156 3964.0
313.62890625 11383.0
318.949340820312 1945.0
319.691772460938 2781.0
326.534423828125 4564.0
331.253601074219 7761.0
334.9482421875 4798.0
336.904418945312 5597.0
338.891174316406 5830.0
342.512817382812 8324.0
343.478881835938 12579.0
344.843627929688 3118.0
347.899291992188 7021.0
348.722778320312 2224.0
350.681274414062 2440.0
357.763061523438 14220.0
359.35986328125 11427.0
360.3603515625 23882.0
361.486633300781 18834.0
362.540954589844 10546.0
363.612121582031 2031.0
364.794799804688 5664.0
368.715576171875 3888.0
372.091003417969 7189.0
372.73583984375 3329.0
376.572204589844 7716.0
378.099853515625 11617.0
378.795227050781 1641.0
380.755065917969 7448.0
386.034118652344 12462.0
389.507751464844 15551.0
390.844665527344 10268.0
391.481140136719 500.0
392.773742675781 2896.0
396.465515136719 3636.0
397.885864257812 1616.0
400.766723632812 1113.0
403.266967773438 8535.0
404.394714355469 1578.0
406.269592285156 7361.0
407.214721679688 919.0
408.305969238281 11683.0
409.64501953125 14506.0
410.707946777344 6735.0
411.557250976562 6330.0
414.049255371094 2606.0
414.9775390625 25274.0
415.742065429688 5809.0
418.659118652344 2842.0
420.640441894531 4050.0
421.357604980469 4565.0
424.955871582031 4801.0
425.623840332031 1578.0
427.966552734375 5836.0
431.106018066406 4433.0
431.956970214844 2428.0
432.5595703125 7390.0
433.419677734375 2093.0
441.233154296875 3196.0
441.985717773438 2048.0
448.181823730469 3643.0
449.430480957031 11621.0
450.174560546875 4437.0
450.84521484375 3907.0
451.573608398438 6557.0
452.447204589844 1461.0
453.993347167969 3555.0
465.704284667969 6213.0
466.320739746094 1146.0
468.420104980469 3492.0
482.678771972656 3357.0
610.4111328125 8968.0
END IONS
FINISH

end
